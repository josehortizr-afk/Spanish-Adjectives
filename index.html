<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Spanish Adjectives Practice</title>
  <style>
    :root{
      --bg:#fafafa;
      --card:#ffffff;
      --border:#e0e0e0;
      --text:#212121;
      --muted:#757575;
      --primary:#2196f3;
      --primary-dark:#1976d2;
      --success:#4caf50;
      --error:#f44336;
    }
    *{box-sizing:border-box;margin:0;padding:0}
    body{
      font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,Oxygen,Ubuntu,sans-serif;
      background:var(--bg);
      color:var(--text);
      line-height:1.6;
      padding:20px;
    }
    .container{max-width:900px;margin:0 auto}

    /* Header */
    header{
      background:var(--card);
      padding:24px;
      border-radius:8px;
      margin-bottom:20px;
      border:1px solid var(--border);
    }
    h1{
      font-size:28px;
      font-weight:600;
      margin-bottom:8px;
      color:var(--text);
    }
    .subtitle{
      font-size:14px;
      color:var(--muted);
      margin-bottom:16px;
    }

    /* Stats */
    .stats{
      display:flex;
      gap:16px;
      justify-content:space-around;
      padding:16px;
      background:var(--bg);
      border-radius:6px;
      margin-bottom:16px;
    }
    .stat-item{
      text-align:center;
    }
    .stat-number{
      font-size:24px;
      font-weight:600;
      color:var(--text);
    }
    .stat-label{
      font-size:12px;
      color:var(--muted);
      margin-top:4px;
    }

    /* Tabs */
    .tabs{
      display:flex;
      gap:8px;
      margin-bottom:20px;
      border-bottom:1px solid var(--border);
      padding-bottom:0;
      flex-wrap:wrap;
    }
    .tab{
      padding:10px 16px;
      cursor:pointer;
      font-weight:500;
      font-size:14px;
      color:var(--muted);
      border-bottom:2px solid transparent;
      transition:all .2s;
    }
    .tab:hover{color:var(--text)}
    .tab.active{
      color:var(--primary);
      border-bottom-color:var(--primary);
    }

    /* Card */
    .card{
      background:var(--card);
      border:1px solid var(--border);
      padding:24px;
      border-radius:8px;
      margin-bottom:20px;
    }

    /* Buttons */
    .btn{
      border:1px solid var(--border);
      background:#f2faff;
      color:var(--text);
      padding:10px 18px;
      border-radius:6px;
      cursor:pointer;
      font-weight:500;
      font-size:14px;
      transition:all .2s;
    }
    .btn:hover{
      background:var(--bg);
      transform:translateY(-1px);
    }
    .btn:active{transform:translateY(0)}
    .btn.primary{
      background:var(--primary);
      border-color:var(--primary);
      color:white;
    }
    .btn.primary:hover{background:var(--primary-dark)}
    .btn.small{padding:6px 12px;font-size:13px}

    /* New: disabled button style so kids see it's "off" */
    .btn[disabled]{
      opacity:0.5;
      cursor:not-allowed;
      transform:none;
      background:#f0f0f0;
    }

    /* Category selector */
    select{
      width:100%;
      padding:10px;
      border:1px solid var(--border);
      border-radius:6px;
      background:#f2faff;
      font-size:14px;
      cursor:pointer;
      margin-bottom:16px;
    }

    /* Flashcard */
    .flashcard-wrapper{
      perspective:1000px;
      min-height:280px;
      margin:24px auto;
      max-width:500px;
    }
    .flashcard{
      position:relative;
      width:100%;
      height:280px;
      transition:transform .6s;
      transform-style:preserve-3d;
      cursor:pointer;
    }
    .flashcard.flipped{transform:rotateY(180deg)}
    .flashcard-face{
      position:absolute;
      width:100%;
      height:100%;
      backface-visibility:hidden;
      border-radius:8px;
      display:flex;
      flex-direction:column;
      align-items:center;
      justify-content:center;
      padding:40px;
      border:1px solid var(--border);
      background:#f2faff;
    }
    .flashcard-front{background:#e6f3ff}
    .flashcard-back{
      background:#f2faff;
      transform:rotateY(180deg);
    }
    .flashcard-text{
      font-size:36px;
      font-weight:600;
      text-align:center;
      color:var(--text);
    }
    .flashcard-hint{
      position:absolute;
      bottom:16px;
      font-size:13px;
      color:var(--muted);
    }

    /* Quiz & Games */
    .prompt{
      font-size:24px;
      font-weight:600;
      margin-bottom:24px;
      text-align:center;
      color:var(--text);
    }
    .options{
      display:grid;
      gap:12px;
      grid-template-columns:repeat(2, 1fr);
      margin-bottom:20px;
    }
    .option{
      padding:16px;
      border-radius:6px;
      border:1px solid var(--border);
      background:#f2faff;
      cursor:pointer;
      font-weight:500;
      font-size:16px;
      text-align:center;
      transition:all .2s;
    }
    .option:hover{
      border-color:var(--primary);
      background:var(--bg);
    }
    .option.correct{
      background:var(--success);
      border-color:var(--success);
      color:white;
    }
    .option.wrong{
      background:var(--error);
      border-color:var(--error);
      color:white;
    }

    /* Audio button */
    .audio-btn{
      padding:30px 45px;
      font-size:2em;
      border:2px solid var(--border);
      background:#f2faff;
      border-radius:50%;
      cursor:pointer;
      transition:all .2s;
      margin:0 auto 24px;
      display:block;
    }
    .audio-btn:hover{
      background:var(--primary);
      border-color:var(--primary);
      transform:scale(1.1);
    }

    /* Feedback */
    .feedback{
      text-align:center;
      font-size:18px;
      font-weight:500;
      margin:16px 0;
      min-height:30px;
    }

    /* Controls */
    .controls{
      display:flex;
      gap:12px;
      justify-content:center;
      margin-top:20px;
      flex-wrap:wrap;
    }

    /* Table */
    .table-container{
      overflow-x:auto;
      margin-top:16px;
    }
    table{
      width:100%;
      border-collapse:collapse;
      background:#f2faff;
    }
    th{
      background:var(--bg);
      padding:12px;
      text-align:left;
      font-weight:600;
      font-size:13px;
      border:1px solid var(--border);
    }
    td{
      padding:12px;
      border:1px solid var(--border);
      font-size:14px;
    }
    tr:nth-child(even){
      background:var(--bg);
    }
    .category-header{
      background:var(--primary);
      color:white;
      font-weight:600;
      text-align:center;
    }

    /* Hidden */
    .hidden{display:none}

    /* Card counter */
    .card-counter{
      text-align:center;
      color:var(--muted);
      font-size:14px;
      margin-bottom:16px;
    }

    /* Sentence Builder */
    .sentence-prompt{
      text-align:center;
      font-size:18px;
      font-weight:600;
      color:var(--text);
      margin-bottom:24px;
      padding:16px;
      background:var(--bg);
      border-radius:6px;
    }
    .word-bank{
      display:flex;
      flex-wrap:wrap;
      gap:10px;
      justify-content:center;
      padding:20px;
      background:var(--bg);
      border-radius:8px;
      margin-bottom:24px;
      min-height:80px;
    }
    .word-chip{
      padding:10px 16px;
      background:#f2faff;
      border:2px solid var(--border);
      border-radius:20px;
      cursor:grab;
      font-weight:500;
      font-size:15px;
      transition:all .2s;
      user-select:none;
    }
    .word-chip:hover{
      border-color:var(--primary);
      transform:translateY(-2px);
      box-shadow:0 4px 8px rgba(0,0,0,0.1);
    }
    .word-chip:active{
      cursor:grabbing;
    }
    .word-chip.placed{
      opacity:0.3;
      cursor:not-allowed;
    }
    .answer-slots{
      display:flex;
      flex-wrap:wrap;
      gap:10px;
      justify-content:center;
      padding:24px;
      background:#f2faff;
      border:2px dashed var(--border);
      border-radius:8px;
      margin-bottom:20px;
      min-height:100px;
      align-items:center;
    }
    .answer-slot{
      min-width:90px;
      padding:10px 16px;
      border:2px dashed var(--border);
      border-radius:10px;
      text-align:center;
      font-weight:500;
      font-size:15px;
      background:var(--bg);
      transition:all .2s;
    }
    .answer-slot.filled{
      background:#f2faff;
      border-style:solid;
      border-color:var(--primary);
    }
    .answer-slot.filled:hover{
      cursor:pointer;
      border-color:var(--error);
    }
    .answer-slot.correct{
      background:var(--success);
      border-color:var(--success);
      color:white;
    }
    .answer-slot.wrong{
      background:var(--error);
      border-color:var(--error);
      color:white;
    }
    .sentence-feedback{
      text-align:center;
      font-size:16px;
      font-weight:600;
      margin:16px 0;
      min-height:30px;
    }

    .how-to-box{
      background:#e3f2fd;
      border-radius:8px;
      padding:12px 16px;
      font-size:14px;
      margin-bottom:16px;
      border:1px solid #bbdefb;
    }
    .how-to-box strong{
      display:block;
      margin-bottom:4px;
    }
    .how-to-steps{
      list-style:none;
      padding-left:0;
    }
    .how-to-steps li{
      margin-bottom:4px;
    }

    /* Memory Game */
    .memory-grid{
      display:grid;
      gap:12px;
      margin:24px auto;
      max-width:600px;
      grid-template-columns:repeat(4, 1fr);
    }
    .memory-card{
      aspect-ratio:1;
      background:#f2faff;
      border:2px solid var(--border);
      border-radius:8px;
      cursor:pointer;
      display:flex;
      align-items:center;
      justify-content:center;
      font-size:18px;
      font-weight:600;
      transition:all .3s;
      position:relative;
      transform-style:preserve-3d;
    }
    .memory-card:hover:not(.flipped):not(.matched){
      border-color:var(--primary);
      transform:scale(1.05);
    }
    .memory-card.flipped{
      background:var(--primary);
      color:white;
      border-color:var(--primary);
    }
    .memory-card.matched{
      background:var(--success);
      color:white;
      border-color:var(--success);
      cursor:default;
    }
    .memory-card .card-back{
      font-size:32px;
    }
    .memory-stats{
      display:flex;
      justify-content:space-around;
      margin-bottom:20px;
      padding:16px;
      background:var(--bg);
      border-radius:6px;
    }
    .memory-stat{
      text-align:center;
    }
    .memory-stat-number{
      font-size:24px;
      font-weight:600;
      color:var(--primary);
    }
    .memory-stat-label{
      font-size:12px;
      color:var(--muted);
      margin-top:4px;
    }

    @media (max-width: 600px){
      .options{
        grid-template-columns:1fr;
      }
      .stats{
        flex-direction:column;
        gap:8px;
      }
    }
  </style>
</head>
<body>
  <div class="container">
    <header>
      <h1>üéÆ Spanish Adjectives Practice</h1>
      <p class="subtitle">Learn and practice Spanish adjectives with interactive games</p>

      <div class="stats">
        <div class="stat-item">
          <div class="stat-number" id="correct">0</div>
          <div class="stat-label">Correct ‚úÖ</div>
        </div>
        <div class="stat-item">
          <div class="stat-number" id="streak">0</div>
          <div class="stat-label">Streak üî•</div>
        </div>
        <div class="stat-item">
          <div class="stat-number" id="total">0</div>
          <div class="stat-label">Played üéØ</div>
        </div>
      </div>
    </header>

    <div class="tabs" id="tabs"></div>
    <div class="card" id="view"></div>
  </div>

  <script>
    const $ = (s) => document.querySelector(s);
    const $$ = (s) => document.querySelectorAll(s);

    // Adjectives database - EXACT vocabulary from user's list
    const adjectives = {
      'Physical Description': [
        { word: 'alto/a', wordEn: 'tall', masculine: 'alto', feminine: 'alta' },
        { word: 'bajo/a', wordEn: 'short', masculine: 'bajo', feminine: 'baja' },
        { word: 'delgado/a', wordEn: 'thin', masculine: 'delgado', feminine: 'delgada' },
        { word: 'gordo/a', wordEn: 'fat', masculine: 'gordo', feminine: 'gorda' },
        { word: 'fuerte', wordEn: 'strong', masculine: 'fuerte', feminine: 'fuerte' },
        { word: 'd√©bil', wordEn: 'weak', masculine: 'd√©bil', feminine: 'd√©bil' },
        { word: 'joven', wordEn: 'young', masculine: 'joven', feminine: 'joven' },
        { word: 'viejo/a', wordEn: 'old', masculine: 'viejo', feminine: 'vieja' },
        { word: 'guapo/a', wordEn: 'good-looking', masculine: 'guapo', feminine: 'guapa' },
        { word: 'feo/a', wordEn: 'ugly', masculine: 'feo', feminine: 'fea' }
      ],
      'Personality & Character': [
        { word: 'simp√°tico/a', wordEn: 'nice, friendly', masculine: 'simp√°tico', feminine: 'simp√°tica' },
        { word: 't√≠mido/a', wordEn: 'shy', masculine: 't√≠mido', feminine: 't√≠mida' },
        { word: 'serio/a', wordEn: 'serious', masculine: 'serio', feminine: 'seria' },
        { word: 'divertido/a', wordEn: 'fun', masculine: 'divertido', feminine: 'divertida' },
        { word: 'aburrido/a', wordEn: 'boring', masculine: 'aburrido', feminine: 'aburrida' },
        { word: 'inteligente', wordEn: 'smart', masculine: 'inteligente', feminine: 'inteligente' },
        { word: 'tonto/a', wordEn: 'silly', masculine: 'tonto', feminine: 'tonta' },
        { word: 'trabajador(a)', wordEn: 'hardworking', masculine: 'trabajador', feminine: 'trabajadora' },
        { word: 'perezoso/a', wordEn: 'lazy', masculine: 'perezoso', feminine: 'perezosa' },
        { word: 'amable', wordEn: 'kind', masculine: 'amable', feminine: 'amable' },
        { word: 'tranquilo/a', wordEn: 'calm', masculine: 'tranquilo', feminine: 'tranquila' },
        { word: 'hablador(a)', wordEn: 'talkative', masculine: 'hablador', feminine: 'habladora' }
      ],
      'Size & Shape': [
        { word: 'grande', wordEn: 'big', masculine: 'grande', feminine: 'grande' },
        { word: 'peque√±o/a', wordEn: 'small', masculine: 'peque√±o', feminine: 'peque√±a' },
        { word: 'largo/a', wordEn: 'long', masculine: 'largo', feminine: 'larga' },
        { word: 'corto/a', wordEn: 'short', masculine: 'corto', feminine: 'corta' },
        { word: 'ancho/a', wordEn: 'wide', masculine: 'ancho', feminine: 'ancha' },
        { word: 'pesado/a', wordEn: 'heavy', masculine: 'pesado', feminine: 'pesada' },
        { word: 'alto', wordEn: 'tall (object)', masculine: 'alto', feminine: 'alto' },
        { word: 'bajo', wordEn: 'short (object)', masculine: 'bajo', feminine: 'bajo' },
        { word: 'redondo/a', wordEn: 'round', masculine: 'redondo', feminine: 'redonda' },
        { word: 'cuadrado/a', wordEn: 'square', masculine: 'cuadrado', feminine: 'cuadrada' }
      ],
      'Condition & Quality': [
        { word: 'limpio/a', wordEn: 'clean', masculine: 'limpio', feminine: 'limpia' },
        { word: 'sucio/a', wordEn: 'dirty', masculine: 'sucio', feminine: 'sucia' },
        { word: 'nuevo/a', wordEn: 'new', masculine: 'nuevo', feminine: 'nueva' },
        { word: 'viejo/a', wordEn: 'old (thing)', masculine: 'viejo', feminine: 'vieja' },
        { word: 'roto/a', wordEn: 'broken', masculine: 'roto', feminine: 'rota' },
        { word: 'abierto/a', wordEn: 'open', masculine: 'abierto', feminine: 'abierta' },
        { word: 'cerrado/a', wordEn: 'closed', masculine: 'cerrado', feminine: 'cerrada' },
        { word: 'mojado/a', wordEn: 'wet', masculine: 'mojado', feminine: 'mojada' },
        { word: 'seco/a', wordEn: 'dry', masculine: 'seco', feminine: 'seca' },
        { word: 'lleno/a', wordEn: 'full', masculine: 'lleno', feminine: 'llena' }
      ],
      'Physical & Emotional States': [
        { word: 'cansado/a', wordEn: 'tired', masculine: 'cansado', feminine: 'cansada' },
        { word: 'enfermo/a', wordEn: 'sick', masculine: 'enfermo', feminine: 'enferma' },
        { word: 'bien', wordEn: 'well', masculine: 'bien', feminine: 'bien' },
        { word: 'mal', wordEn: 'unwell', masculine: 'mal', feminine: 'mal' },
        { word: 'feliz', wordEn: 'happy', masculine: 'feliz', feminine: 'feliz' },
        { word: 'triste', wordEn: 'sad', masculine: 'triste', feminine: 'triste' },
        { word: 'preocupado/a', wordEn: 'worried', masculine: 'preocupado', feminine: 'preocupada' },
        { word: 'enojado/a', wordEn: 'angry', masculine: 'enojado', feminine: 'enojada' },
        { word: 'contento/a', wordEn: 'happy, pleased', masculine: 'contento', feminine: 'contenta' },
        { word: 'nervioso/a', wordEn: 'nervous', masculine: 'nervioso', feminine: 'nerviosa' },
        { word: 'emocionado/a', wordEn: 'excited', masculine: 'emocionado', feminine: 'emocionada' },
        { word: 'relajado/a', wordEn: 'relaxed', masculine: 'relajado', feminine: 'relajada' },
        { word: 'asustado/a', wordEn: 'scared', masculine: 'asustado', feminine: 'asustada' },
        { word: 'aburrido/a', wordEn: 'bored', masculine: 'aburrido', feminine: 'aburrida' },
        { word: 'sorprendido/a', wordEn: 'surprised', masculine: 'sorprendido', feminine: 'sorprendida' }
      ]
    };

    // Flatten all adjectives
    let allWords = [];
    Object.keys(adjectives).forEach(cat => {
      adjectives[cat].forEach(item => {
        allWords.push({ ...item, category: cat });
      });
    });

    // Create opposite pairs for Opposite Finder game
    const oppositePairs = [
      // Physical Description
      { word: 'alto', opposite: 'bajo', wordEn: 'tall', oppositeEn: 'short' },
      { word: 'delgado', opposite: 'gordo', wordEn: 'thin', oppositeEn: 'fat' },
      { word: 'fuerte', opposite: 'd√©bil', wordEn: 'strong', oppositeEn: 'weak' },
      { word: 'joven', opposite: 'viejo', wordEn: 'young', oppositeEn: 'old' },
      { word: 'guapo', opposite: 'feo', wordEn: 'good-looking', oppositeEn: 'ugly' },
      // Personality & Character
      { word: 'simp√°tico', opposite: 'antip√°tico', wordEn: 'nice, friendly', oppositeEn: 'unfriendly' },
      { word: 't√≠mido', opposite: 'extrovertido', wordEn: 'shy', oppositeEn: 'outgoing' },
      { word: 'serio', opposite: 'divertido', wordEn: 'serious', oppositeEn: 'fun' },
      { word: 'inteligente', opposite: 'tonto', wordEn: 'smart', oppositeEn: 'silly' },
      { word: 'trabajador', opposite: 'perezoso', wordEn: 'hardworking', oppositeEn: 'lazy' },
      { word: 'tranquilo', opposite: 'hablador', wordEn: 'calm', oppositeEn: 'talkative' },
      // Size & Shape
      { word: 'grande', opposite: 'peque√±o', wordEn: 'big', oppositeEn: 'small' },
      { word: 'largo', opposite: 'corto', wordEn: 'long', oppositeEn: 'short' },
      { word: 'ancho', opposite: 'estrecho', wordEn: 'wide', oppositeEn: 'narrow' },
      { word: 'pesado', opposite: 'ligero', wordEn: 'heavy', oppositeEn: 'light' },
      { word: 'redondo', opposite: 'cuadrado', wordEn: 'round', oppositeEn: 'square' },
      // Condition & Quality
      { word: 'limpio', opposite: 'sucio', wordEn: 'clean', oppositeEn: 'dirty' },
      { word: 'nuevo', opposite: 'viejo', wordEn: 'new', oppositeEn: 'old (thing)' },
      { word: 'abierto', opposite: 'cerrado', wordEn: 'open', oppositeEn: 'closed' },
      { word: 'mojado', opposite: 'seco', wordEn: 'wet', oppositeEn: 'dry' },
      { word: 'lleno', opposite: 'vac√≠o', wordEn: 'full', oppositeEn: 'empty' },
      // Physical & Emotional States
      { word: 'cansado', opposite: 'descansado', wordEn: 'tired', oppositeEn: 'rested' },
      { word: 'enfermo', opposite: 'sano', wordEn: 'sick', oppositeEn: 'healthy' },
      { word: 'bien', opposite: 'mal', wordEn: 'well', oppositeEn: 'unwell' },
      { word: 'feliz', opposite: 'triste', wordEn: 'happy', oppositeEn: 'sad' },
      { word: 'preocupado', opposite: 'tranquilo', wordEn: 'worried', oppositeEn: 'calm' },
      { word: 'enojado', opposite: 'contento', wordEn: 'angry', oppositeEn: 'happy, pleased' },
      { word: 'nervioso', opposite: 'relajado', wordEn: 'nervous', oppositeEn: 'relaxed' },
      { word: 'emocionado', opposite: 'aburrido', wordEn: 'excited', oppositeEn: 'bored' },
      { word: 'asustado', opposite: 'valiente', wordEn: 'scared', oppositeEn: 'brave' }
    ];

    // State
    let state = {
      mode: 'flashcards',
      category: 'All Categories',
      correct: 0,
      streak: 0,
      total: 0,
      currentIndex: 0,
      deck: [],
      flipped: false
    };

    // Quiz state
    let quizState = {
      mode: null, // 'half' or 'full'
      deck: [],
      currentIndex: 0,
      correctAnswers: 0,
      totalQuestions: 0,
      answers: []
    };

    // Utilities
    const shuffle = arr => {
      const a = [...arr];
      for (let i = a.length - 1; i > 0; i--) {
        const j = Math.floor(Math.random() * (i + 1));
        [a[i], a[j]] = [a[j], a[i]];
      }
      return a;
    };

    const speak = (text) => {
      if ('speechSynthesis' in window) {
        window.speechSynthesis.cancel();
        const utterance = new SpeechSynthesisUtterance(text);
        utterance.lang = 'es-ES';
        utterance.rate = 0.8;
        window.speechSynthesis.speak(utterance);
      }
    };

    const updateStats = () => {
      $('#correct').textContent = state.correct;
      $('#streak').textContent = state.streak;
      $('#total').textContent = state.total;
    };

    // Get words by category
    const getWords = () => {
      if (state.category === 'All Categories') return allWords;
      return allWords.filter(w => w.category === state.category);
    };

    // Render tabs (renamed Builder ‚Üí Sentence Builder)
    const renderTabs = () => {
      const tabs = [
        'üÉè Flashcards',
        
        '‚úèÔ∏è Sentence Builder',
        '‚ÜîÔ∏è Opposites',
        '‚ö° Speed',
        'üìù Quiz',
        'üìö Database'
      ];
      const modes = ['flashcards',  'builder', 'opposites', 'speed', 'quiz', 'database'];

      $('#tabs').innerHTML = tabs.map((tab, i) => 
        `<div class="tab ${state.mode === modes[i] ? 'active' : ''}" onclick="setMode('${modes[i]}')">${tab}</div>`
      ).join('');
    };

    // Set mode
    window.setMode = (mode) => {
      state.mode = mode;
      renderTabs();

      switch(mode) {
        case 'flashcards': renderFlashcards(); break;
        
        case 'quiz': renderQuiz(); break;
        case 'builder': renderBuilder(); break;
        case 'opposites': renderOpposites(); break;
        case 'speed': renderSpeed(); break;
        case 'database': renderDatabase(); break;
      }
    };

    // === FLASHCARDS ===
    const renderFlashcards = () => {
      const words = getWords();
      if (!state.deck.length) {
        state.deck = shuffle(words);
        state.currentIndex = 0;
      }

      const current = state.deck[state.currentIndex];

      $('#view').innerHTML = `
        <label style="display:block;font-weight:600;margin-bottom:8px;font-size:14px">Select Category</label>
        <select onchange="changeCategory(this.value)">
          ${['All Categories', ...Object.keys(adjectives)].map(cat => 
            `<option value="${cat}" ${state.category === cat ? 'selected' : ''}>${cat}</option>`
          ).join('')}
        </select>

        <div class="flashcard-wrapper">
          <div class="flashcard ${state.flipped ? 'flipped' : ''}" onclick="flipCard()">
            <div class="flashcard-face flashcard-front">
              <div class="flashcard-text">${current.word}</div>
              <div class="flashcard-hint">Click to see English</div>
            </div>
            <div class="flashcard-face flashcard-back">
              <div class="flashcard-text">${current.wordEn}</div>
            </div>
          </div>
        </div>

        <div style="text-align:center;margin-bottom:12px">
          <button class="btn small" onclick="playFlashcardAudio()">üîä Listen to pronunciation</button>
        </div>

        <div class="card-counter">Card ${state.currentIndex + 1} of ${state.deck.length}</div>

        <div class="controls">
          <button class="btn" onclick="prevCard()">‚Üê Previous</button>
          <button class="btn" onclick="shuffleDeck()">üîÄ Shuffle</button>
          <button class="btn" onclick="nextCard()">Next ‚Üí</button>
        </div>
      `;
    };

    window.playFlashcardAudio = () => {
      const current = state.deck[state.currentIndex];
      if (current) {
        speak(current.word);
      }
    };

    window.flipCard = () => {
      state.flipped = !state.flipped;
      renderFlashcards();
    };

    window.nextCard = () => {
      state.currentIndex = (state.currentIndex + 1) % state.deck.length;
      state.flipped = false;
      renderFlashcards();
    };

    window.prevCard = () => {
      state.currentIndex = (state.currentIndex - 1 + state.deck.length) % state.deck.length;
      state.flipped = false;
      renderFlashcards();
    };

    window.shuffleDeck = () => {
      state.deck = shuffle(getWords());
      state.currentIndex = 0;
      state.flipped = false;
      renderFlashcards();
    };

    window.changeCategory = (cat) => {
      state.category = cat;
      state.deck = [];
      state.currentIndex = 0;
      state.flipped = false;
      renderFlashcards();
    };

    // === LISTENING ===
    let listeningQuestion = null;

    const renderListening = () => {
      loadListeningQuestion();
    };

    const loadListeningQuestion = () => {
      const words = getWords();
      listeningQuestion = words[Math.floor(Math.random() * words.length)];

      const wrong = shuffle(words.filter(w => w.word !== listeningQuestion.word)).slice(0, 3);
      const options = shuffle([listeningQuestion.word, ...wrong.map(w => w.word)]);

      $('#view').innerHTML = `
        <h3 style="text-align:center;margin-bottom:20px;font-size:18px;font-weight:600">üîä Listen and Choose</h3>

        <button class="audio-btn" onclick="playAudio()">üîä</button>
        <div style="text-align:center;color:var(--muted);font-size:14px;margin-bottom:24px">Click to hear the word</div>

        <div class="feedback" id="feedback"></div>

        <div class="options">
          ${options.map(opt => 
            `<div class="option" onclick="checkListening('${opt}')">${opt}</div>`
          ).join('')}
        </div>

        <div class="controls">
          <button class="btn" onclick="playAudio()">üîÅ Play Again</button>
        </div>
      `;

      setTimeout(() => playAudio(), 300);
    };

    window.playAudio = () => {
      speak(listeningQuestion.word);
    };

    window.checkListening = (answer) => {
      state.total++;
      const correct = answer === listeningQuestion.word;

      if (correct) {
        state.correct++;
        state.streak++;
        $('#feedback').innerHTML = '‚úÖ Correct!';
      } else {
        state.streak = 0;
        $('#feedback').innerHTML = `‚ùå Wrong! Answer: ${listeningQuestion.word}`;
      }

      updateStats();
      $$('.option').forEach(el => el.style.pointerEvents = 'none');

      setTimeout(() => loadListeningQuestion(), 2000);
    };

    // === QUIZ ===
    const renderQuiz = () => {
      if (!quizState.mode) {
        renderQuizSetup();
      } else if (quizState.currentIndex < quizState.deck.length) {
        renderQuizQuestion();
      } else {
        renderQuizResults();
      }
    };

    const renderQuizSetup = () => {
      const words = getWords();
      const halfDeck = Math.ceil(words.length / 2);

      $('#view').innerHTML = `
        <h3 style="text-align:center;margin-bottom:20px;font-size:18px;font-weight:600">üìù Quiz Mode</h3>
        <p style="text-align:center;color:var(--muted);margin-bottom:32px">Test your knowledge! Choose your quiz length.</p>

        <div style="max-width:400px;margin:0 auto;display:flex;flex-direction:column;gap:16px">
          <button class="btn primary" onclick="startQuiz('half')" style="padding:20px;font-size:16px">
            üìä Half Deck Quiz<br>
            <span style="font-size:13px;font-weight:normal;opacity:0.9">${halfDeck} questions</span>
          </button>

          <button class="btn primary" onclick="startQuiz('full')" style="padding:20px;font-size:16px">
            üéØ Full Deck Quiz<br>
            <span style="font-size:13px;font-weight:normal;opacity:0.9">${words.length} questions</span>
          </button>
        </div>
      `;
    };

    window.startQuiz = (mode) => {
      const words = getWords();
      const shuffled = shuffle([...words]);

      quizState.mode = mode;
      quizState.deck = mode === 'half' 
        ? shuffled.slice(0, Math.ceil(words.length / 2))
        : shuffled;
      quizState.currentIndex = 0;
      quizState.correctAnswers = 0;
      quizState.totalQuestions = quizState.deck.length;
      quizState.answers = [];

      renderQuizQuestion();
    };

    const renderQuizQuestion = () => {
      const current = quizState.deck[quizState.currentIndex];
      const allEn = [...new Set(allWords.map(w => w.wordEn))];
      const wrong = shuffle(allEn.filter(en => en !== current.wordEn)).slice(0, 3);
      const options = shuffle([current.wordEn, ...wrong]);

      const progress = ((quizState.currentIndex / quizState.totalQuestions) * 100).toFixed(0);

      $('#view').innerHTML = `
        <div style="margin-bottom:20px">
          <div style="display:flex;justify-content:space-between;margin-bottom:8px;font-size:14px">
            <span style="color:var(--muted)">Question ${quizState.currentIndex + 1} of ${quizState.totalQuestions}</span>
            <span style="font-weight:600;color:var(--primary)">${progress}% Complete</span>
          </div>
          <div style="background:var(--bg);height:8px;border-radius:4px;overflow:hidden">
            <div style="background:var(--primary);height:100%;width:${progress}%;transition:width 0.3s"></div>
          </div>
        </div>

        <div style="text-align:center;margin-bottom:16px">
          <div style="display:inline-block;padding:8px 16px;background:var(--bg);border-radius:6px;font-size:14px">
            ‚úÖ ${quizState.correctAnswers} correct | ‚ùå ${quizState.currentIndex - quizState.correctAnswers} wrong
          </div>
        </div>

        <div class="prompt">${current.word}</div>
        <div class="feedback" id="quiz-feedback"></div>
        <div class="options" id="quiz-options">
          ${options.map(opt => 
            `<div class="option" onclick="checkQuizAnswer('${opt.replace(/'/g, "\'")}', '${current.wordEn.replace(/'/g, "\'")}')">${opt}</div>`
          ).join('')}
        </div>
      `;
    };

    window.checkQuizAnswer = (answer, correct) => {
      const isCorrect = answer === correct;
      const feedback = $('#quiz-feedback');

      if (isCorrect) {
        quizState.correctAnswers++;
        feedback.innerHTML = '‚úÖ Correct!';
        feedback.style.color = 'var(--success)';
      } else {
        feedback.innerHTML = `‚ùå Wrong! Answer: ${correct}`;
        feedback.style.color = 'var(--error)';
      }

      quizState.answers.push({
        question: quizState.deck[quizState.currentIndex].word,
        correct: correct,
        userAnswer: answer,
        isCorrect: isCorrect
      });

      $$('#quiz-options .option').forEach(el => {
        el.style.pointerEvents = 'none';
        if (el.textContent === correct) {
          el.classList.add('correct');
        } else if (el.textContent === answer && !isCorrect) {
          el.classList.add('wrong');
        }
      });

      setTimeout(() => {
        quizState.currentIndex++;
        renderQuiz();
      }, 1500);
    };

    const renderQuizResults = () => {
      const percentage = ((quizState.correctAnswers / quizState.totalQuestions) * 100).toFixed(1);
      const grade = percentage >= 90 ? 'üèÜ Excellent!' : 
                    percentage >= 75 ? 'üåü Great Job!' :
                    percentage >= 60 ? 'üëç Good!' :
                    'üí™ Keep Practicing!';

      let wrongAnswers = quizState.answers.filter(a => !a.isCorrect);

      $('#view').innerHTML = `
        <h3 style="text-align:center;font-size:24px;font-weight:600;margin-bottom:16px">Quiz Complete!</h3>

        <div style="text-align:center;margin-bottom:32px">
          <div style="font-size:48px;font-weight:700;color:var(--primary);margin-bottom:8px">${percentage}%</div>
          <div style="font-size:20px;margin-bottom:16px">${grade}</div>
          <div style="font-size:16px;color:var(--muted)">
            ${quizState.correctAnswers} out of ${quizState.totalQuestions} correct
          </div>
        </div>

        <div style="background:var(--bg);padding:20px;border-radius:8px;margin-bottom:20px">
          <div style="display:grid;grid-template-columns:repeat(3,1fr);gap:16px;text-align:center">
            <div>
              <div style="font-size:24px;font-weight:600;color:var(--success)">‚úÖ ${quizState.correctAnswers}</div>
              <div style="font-size:13px;color:var(--muted)">Correct</div>
            </div>
            <div>
              <div style="font-size:24px;font-weight:600;color:var(--error)">‚ùå ${wrongAnswers.length}</div>
              <div style="font-size:13px;color:var(--muted)">Wrong</div>
            </div>
            <div>
              <div style="font-size:24px;font-weight:600;color:var(--primary)">${quizState.totalQuestions}</div>
              <div style="font-size:13px;color:var(--muted)">Total</div>
            </div>
          </div>
        </div>

        ${wrongAnswers.length > 0 ? `
          <details style="background:#f2faff;padding:16px;border-radius:8px;border:1px solid var(--border);margin-bottom:20px">
            <summary style="cursor:pointer;font-weight:600;color:var(--text)">Review Mistakes (${wrongAnswers.length})</summary>
            <div style="margin-top:16px">
              ${wrongAnswers.map((ans, idx) => `
                <div style="padding:12px;background:var(--bg);border-radius:6px;margin-bottom:8px">
                  <div style="font-weight:600;margin-bottom:4px">${ans.question}</div>
                  <div style="font-size:14px;color:var(--error)">Your answer: ${ans.userAnswer}</div>
                  <div style="font-size:14px;color:var(--success)">Correct: ${ans.correct}</div>
                </div>
              `).join('')}
            </div>
          </details>
        ` : ''}

        <div class="controls">
          <button class="btn primary" onclick="retakeQuiz()">üîÑ Retake Quiz</button>
          <button class="btn" onclick="backToQuizMenu()">‚Üê Back to Menu</button>
        </div>
      `;
    };

    window.retakeQuiz = () => {
      startQuiz(quizState.mode);
    };

    window.backToQuizMenu = () => {
      quizState.mode = null;
      renderQuizSetup();
    };

    // === DATABASE ===
    const renderDatabase = () => {
      let html = '<h3 style="font-size:18px;font-weight:600;margin-bottom:16px">Adjectives Database</h3>';
      html += '<div class="table-container"><table>';
      html += '<thead><tr><th>English</th><th>Masculine</th><th>Feminine</th></tr></thead>';
      html += '<tbody>';

      Object.keys(adjectives).forEach(cat => {
        html += `<tr><td colspan="3" class="category-header">${cat}</td></tr>`;
        adjectives[cat].forEach(item => {
          html += `<tr>
            <td>${item.wordEn}</td>
            <td><strong>${item.masculine}</strong></td>
            <td><strong>${item.feminine}</strong></td>
          </tr>`;
        });
      });

      html += '</tbody></table></div>';
      $('#view').innerHTML = html;
    };

    // === SENTENCE BUILDER (kids-friendly) ===

    // A1 Level Nouns for Sentence Builder (kept for future expansion if you want dynamic building)
    const builderNouns = {
      people: [
        { noun: 'el ni√±o', nounEn: 'the boy', gender: 'm' },
        { noun: 'la ni√±a', nounEn: 'the girl', gender: 'f' },
        { noun: 'el hombre', nounEn: 'the man', gender: 'm' },
        { noun: 'la mujer', nounEn: 'the woman', gender: 'f' },
        { noun: 'el amigo', nounEn: 'the friend', gender: 'm' },
        { noun: 'la amiga', nounEn: 'the friend', gender: 'f' },
        { noun: 'el profesor', nounEn: 'the teacher', gender: 'm' },
        { noun: 'la profesora', nounEn: 'the teacher', gender: 'f' }
      ],
      places_things: [
        { noun: 'la casa', nounEn: 'the house', gender: 'f' },
        { noun: 'el coche', nounEn: 'the car', gender: 'm' },
        { noun: 'el libro', nounEn: 'the book', gender: 'm' },
        { noun: 'la mesa', nounEn: 'the table', gender: 'f' },
        { noun: 'la silla', nounEn: 'the chair', gender: 'f' },
        { noun: 'la puerta', nounEn: 'the door', gender: 'f' },
        { noun: 'la ventana', nounEn: 'the window', gender: 'f' },
        { noun: 'el cuarto', nounEn: 'the room', gender: 'm' },
        { noun: 'la calle', nounEn: 'the street', gender: 'f' },
        { noun: 'la escuela', nounEn: 'the school', gender: 'f' }
      ],
      animals: [
        { noun: 'el perro', nounEn: 'the dog', gender: 'm' },
        { noun: 'el gato', nounEn: 'the cat', gender: 'm' },
        { noun: 'el p√°jaro', nounEn: 'the bird', gender: 'm' },
        { noun: 'el pez', nounEn: 'the fish', gender: 'm' },
        { noun: 'el caballo', nounEn: 'the horse', gender: 'm' }
      ],
      objects: [
        { noun: 'el tel√©fono', nounEn: 'the phone', gender: 'm' },
        { noun: 'la computadora', nounEn: 'the computer', gender: 'f' },
        { noun: 'la bolsa', nounEn: 'the bag', gender: 'f' },
        { noun: 'el reloj', nounEn: 'the clock', gender: 'm' }
      ]
    };

    // Pre-made logical sentences appropriate for middle school
    const sentenceTemplates = [
      // People - physical descriptions
      { en: "The boy is tall", es: ["El", "ni√±o", "es", "alto"] },
      { en: "The girl is tall", es: ["La", "ni√±a", "es", "alta"] },
      { en: "The boy is short", es: ["El", "ni√±o", "es", "bajo"] },
      { en: "The girl is short", es: ["La", "ni√±a", "es", "baja"] },
      { en: "The man is strong", es: ["El", "hombre", "es", "fuerte"] },
      { en: "The woman is strong", es: ["La", "mujer", "es", "fuerte"] },
      { en: "The man is young", es: ["El", "hombre", "es", "joven"] },
      { en: "The woman is young", es: ["La", "mujer", "es", "joven"] },
      { en: "The teacher is smart", es: ["El", "profesor", "es", "inteligente"] },
      { en: "The teacher is kind", es: ["La", "profesora", "es", "amable"] },

      // People - emotions/states
      { en: "The boy is happy", es: ["El", "ni√±o", "est√°", "feliz"] },
      { en: "The girl is happy", es: ["La", "ni√±a", "est√°", "feliz"] },
      { en: "The boy is sad", es: ["El", "ni√±o", "est√°", "triste"] },
      { en: "The girl is sad", es: ["La", "ni√±a", "est√°", "triste"] },
      { en: "The friend is tired", es: ["El", "amigo", "est√°", "cansado"] },
      { en: "The friend is tired", es: ["La", "amiga", "est√°", "cansada"] },
      { en: "The man is nervous", es: ["El", "hombre", "est√°", "nervioso"] },
      { en: "The woman is nervous", es: ["La", "mujer", "est√°", "nerviosa"] },

      // Animals
      { en: "The dog is big", es: ["El", "perro", "es", "grande"] },
      { en: "The cat is small", es: ["El", "gato", "es", "peque√±o"] },
      { en: "The dog is happy", es: ["El", "perro", "est√°", "feliz"] },
      { en: "The cat is sad", es: ["El", "gato", "est√°", "triste"] },
      { en: "The horse is strong", es: ["El", "caballo", "es", "fuerte"] },
      { en: "The bird is small", es: ["El", "p√°jaro", "es", "peque√±o"] },

      // Things - physical qualities
      { en: "The house is big", es: ["La", "casa", "es", "grande"] },
      { en: "The house is small", es: ["La", "casa", "es", "peque√±a"] },
      { en: "The car is new", es: ["El", "coche", "es", "nuevo"] },
      { en: "The car is old", es: ["El", "coche", "es", "viejo"] },
      { en: "The book is new", es: ["El", "libro", "es", "nuevo"] },
      { en: "The book is old", es: ["El", "libro", "es", "viejo"] },
      { en: "The school is big", es: ["La", "escuela", "es", "grande"] },
      { en: "The phone is new", es: ["El", "tel√©fono", "es", "nuevo"] },

      // Things - states/conditions
      { en: "The room is clean", es: ["El", "cuarto", "est√°", "limpio"] },
      { en: "The room is dirty", es: ["El", "cuarto", "est√°", "sucio"] },
      { en: "The table is clean", es: ["La", "mesa", "est√°", "limpia"] },
      { en: "The table is dirty", es: ["La", "mesa", "est√°", "sucia"] },
      { en: "The door is open", es: ["La", "puerta", "est√°", "abierta"] },
      { en: "The door is closed", es: ["La", "puerta", "est√°", "cerrada"] },
      { en: "The window is open", es: ["La", "ventana", "est√°", "abierta"] },
      { en: "The window is closed", es: ["La", "ventana", "est√°", "cerrada"] },
      { en: "The bag is full", es: ["La", "bolsa", "est√°", "llena"] },
      { en: "The street is long", es: ["La", "calle", "es", "larga"] },
      { en: "The street is short", es: ["La", "calle", "es", "corta"] }
    ];

    // New builder state with feedback + slot colors
    let builderState = {
      currentSentence: null,
      userAnswer: [],
      availableWords: [],
      checked: false,
      feedbackHtml: '',
      slotResults: [] // 'correct' | 'wrong' | null
    };

    const renderBuilder = () => {
      loadBuilderSentence();
    };

    const loadBuilderSentence = () => {
      builderState.currentSentence = sentenceTemplates[Math.floor(Math.random() * sentenceTemplates.length)];
      builderState.userAnswer = Array(builderState.currentSentence.es.length).fill(null);
      builderState.availableWords = shuffle([...builderState.currentSentence.es]);
      builderState.checked = false;
      builderState.feedbackHtml = '';
      builderState.slotResults = Array(builderState.currentSentence.es.length).fill(null);

      renderBuilderUI();
    };

    const renderBuilderUI = () => {
      const allFilled = !builderState.userAnswer.includes(null);

      $('#view').innerHTML = `
        <h3 style="text-align:center;margin-bottom:12px;font-size:18px;font-weight:600">‚úèÔ∏è Sentence Builder</h3>

        <div class="how-to-box">
          <strong>How to play:</strong>
          <ul class="how-to-steps">
            <li>1Ô∏è‚É£ Read the English sentence.</li>
            <li>2Ô∏è‚É£ Tap the Spanish words in the word bank to put them in order.</li>
            <li>3Ô∏è‚É£ If you make a mistake, tap a word in your sentence to remove it.</li>
            <li>4Ô∏è‚É£ When all the boxes are full, tap <b>‚ÄúCheck Answer‚Äù</b>.</li>
          </ul>
        </div>

        <div class="sentence-prompt">
          Translate: <strong>"${builderState.currentSentence.en}"</strong><br>
          <span style="font-size:13px;color:var(--muted)">Build the sentence in Spanish.</span>
        </div>

        <div class="word-bank" id="word-bank">
          ${builderState.availableWords.map(word => 
            builderState.userAnswer.includes(word) 
              ? `<div class="word-chip placed">${word}</div>`
              : `<div class="word-chip" onclick="placeWord('${word}')">${word}</div>`
          ).join('')}
        </div>

        <div style="text-align:center;font-size:13px;color:var(--muted);margin-bottom:6px">
          Tap the words below in order (box 1, box 2, box 3...).
        </div>
        <div class="answer-slots" id="answer-slots">
          ${builderState.userAnswer.map((word, idx) => {
            const status = builderState.slotResults[idx];
            const baseClass = word ? 'answer-slot filled' : 'answer-slot';
            const statusClass = status ? ' ' + status : '';
            const label = word ? word : (idx + 1);
            const onclick = word && !builderState.checked ? `onclick="removeWord(${idx})"` : '';
            return `<div class="${baseClass}${statusClass}" ${onclick}>${label}</div>`;
          }).join('')}
        </div>

        <div class="sentence-feedback" id="builder-feedback">
          ${builderState.feedbackHtml}
        </div>

        <div style="display:flex;gap:12px;justify-content:center;margin-top:10px;flex-wrap:wrap">
          <button class="btn" onclick="clearBuilder()" style="min-width:120px" ${builderState.checked ? 'disabled' : ''}>
            üîÑ Clear
          </button>

          ${builderState.checked ? `
            <button class="btn primary" onclick="nextBuilderQuestion()" style="min-width:200px;padding:12px 24px;font-size:16px">
              ‚Üí Next Sentence
            </button>
          ` : `
            <button class="btn primary" onclick="checkBuilder()" ${allFilled ? '' : 'disabled'} style="min-width:200px;padding:12px 24px;font-size:16px">
              ‚úì Check Answer
            </button>
          `}

          <button class="btn" onclick="skipBuilder()" style="min-width:120px">
            ‚è≠Ô∏è Skip
          </button>
        </div>
      `;
    };

    window.placeWord = (word) => {
      if (builderState.checked) return;
      const emptyIndex = builderState.userAnswer.indexOf(null);
      if (emptyIndex !== -1) {
        builderState.userAnswer[emptyIndex] = word;
        renderBuilderUI();
      }
    };

    window.removeWord = (index) => {
      if (!builderState.checked) {
        builderState.userAnswer[index] = null;
        renderBuilderUI();
      }
    };

    window.clearBuilder = () => {
      if (!builderState.checked) {
        builderState.userAnswer = Array(builderState.currentSentence.es.length).fill(null);
        builderState.slotResults = Array(builderState.currentSentence.es.length).fill(null);
        builderState.feedbackHtml = '';
        renderBuilderUI();
      }
    };

    window.checkBuilder = () => {
      if (builderState.checked) return;

      const correctSentence = builderState.currentSentence.es;
      const isCorrect = builderState.userAnswer.every((word, idx) => 
        word === correctSentence[idx]
      );

      state.total++;
      builderState.checked = true;

      builderState.slotResults = builderState.userAnswer.map((word, idx) =>
        word === correctSentence[idx] ? 'correct' : 'wrong'
      );

      if (isCorrect) {
        state.correct++;
        state.streak++;
        builderState.feedbackHtml = `
          <div style="background:var(--success);color:white;padding:16px;border-radius:8px;font-size:16px;font-weight:600;text-align:center">
            ‚úÖ ¬°PERFECTO! Great job!
          </div>
        `;
      } else {
        state.streak = 0;
        builderState.feedbackHtml = `
          <div style="background:var(--error);color:white;padding:12px;border-radius:8px;margin-bottom:10px;font-size:16px;font-weight:600;text-align:center">
            ‚ùå Not quite right.
          </div>
          <div style="background:#fff3cd;border:2px solid #ffc107;color:#856404;padding:12px;border-radius:8px;text-align:center;font-size:14px">
            <div style="font-weight:600;margin-bottom:6px">Correct sentence:</div>
            <div style="font-size:18px;font-weight:700">${correctSentence.join(' ')}</div>
          </div>
        `;
      }

      updateStats();
      renderBuilderUI();
    };

    window.nextBuilderQuestion = () => {
      loadBuilderSentence();
    };

    window.skipBuilder = () => {
      loadBuilderSentence();
    };

    // === OPPOSITE FINDER ===
    let oppositesState = {
      currentPair: null,
      score: 0,
      total: 0
    };

    const renderOpposites = () => {
      loadOppositeQuestion();
    };

    const loadOppositeQuestion = () => {
      const pair = oppositePairs[Math.floor(Math.random() * oppositePairs.length)];
      const showWord = Math.random() > 0.5;

      oppositesState.currentPair = {
        given: showWord ? pair.word : pair.opposite,
        correct: showWord ? pair.opposite : pair.word,
        givenEn: showWord ? pair.wordEn : pair.oppositeEn,
        correctEn: showWord ? pair.oppositeEn : pair.wordEn
      };

      // Get wrong options (other Spanish words)
      const allSpanish = oppositePairs.flatMap(p => [p.word, p.opposite]);
      const wrong = shuffle(allSpanish.filter(w => w !== oppositesState.currentPair.correct && w !== oppositesState.currentPair.given)).slice(0, 3);
      const options = shuffle([oppositesState.currentPair.correct, ...wrong]);

      $('#view').innerHTML = `
        <h3 style="text-align:center;margin-bottom:20px;font-size:18px;font-weight:600">‚ÜîÔ∏è Find the Opposite</h3>

        <div style="text-align:center;margin-bottom:16px">
          <div style="display:inline-block;padding:8px 16px;background:var(--bg);border-radius:6px;font-size:14px">
            ‚úÖ ${oppositesState.score} | üìä ${oppositesState.total} played
          </div>
        </div>

        <div style="background:var(--bg);padding:32px;border-radius:8px;margin-bottom:24px;text-align:center">
          <div style="font-size:14px;color:var(--muted);margin-bottom:8px">What is the opposite of:</div>
          <div style="font-size:36px;font-weight:700;color:var(--text);margin-bottom:8px">${oppositesState.currentPair.given}</div>
          <div style="font-size:16px;color:var(--muted)">(${oppositesState.currentPair.givenEn})</div>
        </div>

        <div class="feedback" id="opposites-feedback"></div>
        <div class="options" id="opposites-options">
          ${options.map(opt => 
            `<div class="option" onclick="checkOpposite('${opt}')">${opt}</div>`
          ).join('')}
        </div>

        <div style="text-align:center;margin-top:20px">
          <button class="btn small" onclick="skipOpposite()">‚è≠Ô∏è Skip</button>
        </div>
      `;
    };

    window.checkOpposite = (answer) => {
      oppositesState.total++;
      state.total++;

      const correct = answer === oppositesState.currentPair.correct;
      const feedback = $('#opposites-feedback');

      if (correct) {
        oppositesState.score++;
        state.correct++;
        state.streak++;
        feedback.innerHTML = `‚úÖ Correct! ${oppositesState.currentPair.given} ‚Üî ${oppositesState.currentPair.correct}`;
        feedback.style.color = 'var(--success)';
      } else {
        state.streak = 0;
        feedback.innerHTML = `‚ùå Wrong! The opposite of ${oppositesState.currentPair.given} is <strong>${oppositesState.currentPair.correct}</strong> (${oppositesState.currentPair.correctEn})`;
        feedback.style.color = 'var(--error)';
      }

      updateStats();

      $$('#opposites-options .option').forEach(el => {
        el.style.pointerEvents = 'none';
        if (el.textContent === oppositesState.currentPair.correct) {
          el.classList.add('correct');
        } else if (el.textContent === answer && !correct) {
          el.classList.add('wrong');
        }
      });

      setTimeout(() => {
        loadOppositeQuestion();
      }, 2500);
    };

    window.skipOpposite = () => {
      loadOppositeQuestion();
    };

    // === SPEED ROUND ===
    const renderSpeed = () => {
      if (!speedState.active) {
        renderSpeedSetup();
      } else if (speedState.timeLeft > 0 && speedState.currentQuestion) {
        renderSpeedQuestion();
      } else {
        renderSpeedResults();
      }
    };

    let speedState = {
      active: false,
      score: 0,
      timeLeft: 60,
      totalQuestions: 0,
      correctAnswers: 0,
      currentQuestion: null,
      timer: null
    };

    const renderSpeedSetup = () => {
      $('#view').innerHTML = `
        <h3 style="text-align:center;margin-bottom:20px;font-size:18px;font-weight:600">‚ö° Speed Round</h3>
        <p style="text-align:center;color:var(--muted);margin-bottom:32px">How many can you answer in 60 seconds?</p>

        <div style="max-width:400px;margin:0 auto">
          <div style="background:var(--bg);padding:24px;border-radius:8px;margin-bottom:24px">
            <div style="text-align:center;margin-bottom:16px">
              <div style="font-size:48px;font-weight:700;color:var(--primary)">60</div>
              <div style="font-size:14px;color:var(--muted)">seconds</div>
            </div>
            <div style="font-size:14px;color:var(--muted);text-align:center;line-height:1.6">
              ‚Ä¢ Answer as many as you can<br>
              ‚Ä¢ Each correct answer = 10 points<br>
              ‚Ä¢ No penalty for wrong answers<br>
              ‚Ä¢ Think fast!
            </div>
          </div>

          <button class="btn primary" onclick="startSpeed()" style="width:100%;padding:16px;font-size:18px">
            üöÄ Start Speed Round
          </button>
        </div>
      `;
    };

    window.startSpeed = () => {
      speedState = {
        active: true,
        score: 0,
        timeLeft: 60,
        totalQuestions: 0,
        correctAnswers: 0,
        currentQuestion: null,
        timer: null
      };

      // Start countdown timer
      speedState.timer = setInterval(() => {
        speedState.timeLeft--;
        if (speedState.timeLeft <= 0) {
          clearInterval(speedState.timer);
          speedState.currentQuestion = null;
          renderSpeed();
        } else if (speedState.currentQuestion) {
          const timerEl = document.getElementById('speed-timer');
          if (timerEl) {
            timerEl.textContent = speedState.timeLeft;
          }
        }
      }, 1000);

      loadSpeedQuestion();
    };

    const loadSpeedQuestion = () => {
      const words = getWords();
      const word = words[Math.floor(Math.random() * words.length)];

      const allEn = [...new Set(allWords.map(w => w.wordEn))];
      const wrong = shuffle(allEn.filter(en => en !== word.wordEn)).slice(0, 3);
      const options = shuffle([word.wordEn, ...wrong]);

      speedState.currentQuestion = {
        word: word.word,
        correct: word.wordEn,
        options: options
      };
      speedState.totalQuestions++;

      renderSpeedQuestion();
    };

    const renderSpeedQuestion = () => {
      const barWidth = (speedState.timeLeft / 60) * 100;
      const barColor = speedState.timeLeft > 20 ? 'var(--success)' : 
                       speedState.timeLeft > 10 ? '#ffc107' : 
                       'var(--error)';

      $('#view').innerHTML = `
        <div style="margin-bottom:20px">
          <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:12px">
            <div style="font-size:14px;color:var(--muted)">Question ${speedState.totalQuestions}</div>
            <div style="font-size:24px;font-weight:700;color:var(--primary)" id="speed-timer">${speedState.timeLeft}</div>
          </div>
          <div style="background:var(--bg);height:12px;border-radius:6px;overflow:hidden">
            <div style="background:${barColor};height:100%;width:${barWidth}%;transition:width 1s linear"></div>
          </div>
        </div>

        <div style="text-align:center;margin-bottom:16px">
          <div style="display:inline-block;padding:8px 16px;background:var(--primary);color:white;border-radius:6px;font-size:18px;font-weight:600">
            Score: ${speedState.score}
          </div>
        </div>

        <div class="prompt">${speedState.currentQuestion.word}</div>
        <div class="feedback" id="speed-feedback"></div>
        <div class="options" id="speed-options">
          ${speedState.currentQuestion.options.map(opt => 
            `<div class="option" onclick="checkSpeedAnswer('${opt.replace(/'/g, "\'")}', '${speedState.currentQuestion.correct.replace(/'/g, "\'")}')">${opt}</div>`
          ).join('')}
        </div>
      `;
    };

    window.checkSpeedAnswer = (answer, correct) => {
      const isCorrect = answer === correct;
      const feedback = $('#speed-feedback');

      if (isCorrect) {
        speedState.correctAnswers++;
        speedState.score += 10;
        feedback.innerHTML = '‚úÖ +10';
        feedback.style.color = 'var(--success)';
      } else {
        feedback.innerHTML = '‚ùå';
        feedback.style.color = 'var(--error)';
      }

      $$('#speed-options .option').forEach(el => {
        el.style.pointerEvents = 'none';
        if (el.textContent === correct) {
          el.classList.add('correct');
        } else if (el.textContent === answer && !isCorrect) {
          el.classList.add('wrong');
        }
      });

      setTimeout(() => {
        if (speedState.timeLeft > 0) {
          loadSpeedQuestion();
        }
      }, 500);
    };

    const renderSpeedResults = () => {
      if (speedState.timer) {
        clearInterval(speedState.timer);
      }

      const accuracy = speedState.totalQuestions > 0 
        ? ((speedState.correctAnswers / speedState.totalQuestions) * 100).toFixed(1)
        : 0;

      const grade = speedState.score >= 150 ? 'üèÜ Amazing!' :
                    speedState.score >= 100 ? 'üåü Excellent!' :
                    speedState.score >= 50 ? 'üëç Great!' :
                    'üí™ Good Try!';

      $('#view').innerHTML = `
        <h3 style="text-align:center;font-size:24px;font-weight:600;margin-bottom:16px">‚ö° Time's Up!</h3>

        <div style="text-align:center;margin-bottom:32px">
          <div style="font-size:48px;font-weight:700;color:var(--primary);margin-bottom:8px">${speedState.score}</div>
          <div style="font-size:20px;margin-bottom:16px">${grade}</div>
          <div style="font-size:16px;color:var(--muted)">
            ${speedState.correctAnswers} correct out of ${speedState.totalQuestions} questions
          </div>
        </div>

        <div style="background:var(--bg);padding:20px;border-radius:8px;margin-bottom:20px">
          <div style="display:grid;grid-template-columns:repeat(3,1fr);gap:16px;text-align:center">
            <div>
              <div style="font-size:24px;font-weight:600;color:var(--success)">‚úÖ ${speedState.correctAnswers}</div>
              <div style="font-size:13px;color:var(--muted)">Correct</div>
            </div>
            <div>
              <div style="font-size:24px;font-weight:600;color:var(--primary)">${accuracy}%</div>
              <div style="font-size:13px;color:var(--muted)">Accuracy</div>
            </div>
            <div>
              <div style="font-size:24px;font-weight:600;color:var(--text)">${speedState.totalQuestions}</div>
              <div style="font-size:13px;color:var(--muted)">Total</div>
            </div>
          </div>
        </div>

        <div class="controls">
          <button class="btn primary" onclick="startSpeed()">üîÑ Play Again</button>
          <button class="btn" onclick="backToSpeedMenu()">‚Üê Back to Menu</button>
        </div>
      `;
    };

    window.backToSpeedMenu = () => {
      if (speedState.timer) {
        clearInterval(speedState.timer);
      }
      speedState.active = false;
      renderSpeedSetup();
    };

    // Init
    // NOTE: allWords is used in several functions, so we populate it here (after adjectives is defined)
    // (Rebuild allWords in case some browser loads script differently)
    allWords = [];
    Object.keys(adjectives).forEach(cat => {
      adjectives[cat].forEach(item => {
        allWords.push({ ...item, category: cat });
      });
    });

    renderTabs();
    setMode('flashcards');
    updateStats();
  </script>
</body>
</html>
